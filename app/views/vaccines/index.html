{% extends 'layout.html' %}

{% block pageTitle %}
  Vaccines
{% endblock %}

{% set currentSection = "vaccines" %}

{% block content %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">

      <h1 class="nhsuk-heading-xl">Vaccines</h1>

      <p class="nhsuk-body-l">Add and edit your vaccines for your organisation.</p>

      {{ button({
        "text": "Add vaccine",
        "href": "/vaccines/choose-site"
      }) }}

    </div>
  </div>

  {% from 'select/macro.njk' import select %}

  {{ select({
    id: "select-1",
    name: "select-1",
    label: {
      text: "Select site"
    },
    items: [
      {
        value: 1,
        text: "NHS.UK frontend option 1"
      },
      {
        value: 2,
        text: "NHS.UK frontend option 2",
        selected: true
      },
      {
        value: 3,
        text: "NHS.UK frontend option 3",
        disabled: true
      }
    ]
  }) }}


  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

      {% set sites = [] %}
      {% for vaccine in (data.vaccines) %}
        {% if not (sites | arrayOrStringIncludes(vaccine.siteCode)) %}
          {% set sites = (sites.push(vaccine.siteCode), sites) %}
        {% endif %}
      {% endfor %}

      {% for site in sites %}

        <h2 class="nhsuk-heading-m">{{ data.sites[site].name }}</h2>

        {% set vaccinesAtSite = [] %}
        {% for vaccine in (data.vaccines) %}
          {% if vaccine.siteCode == site and not (vaccinesAtSite | arrayOrStringIncludes(vaccine.vaccine)) %}
            {% set vaccinesAtSite = (vaccinesAtSite.push(vaccine.vaccine), vaccinesAtSite) %}
          {% endif %}
        {% endfor %}

        {% for vaccineAtSite in vaccinesAtSite %}

          {% set vaccineProductsAtSite = [] %}
            {% for vaccine in (data.vaccines) %}
              {% if vaccine.vaccine == vaccineAtSite and vaccine.siteCode == site and not (vaccineProductsAtSite | arrayOrStringIncludes(vaccine.vaccineProduct)) %}
                {% set vaccineProductsAtSite = (vaccineProductsAtSite.push(vaccine.vaccineProduct), vaccineProductsAtSite) %}
              {% endif %}
            {% endfor %}


          <table class="nhsuk-table">
            <caption class="nhsuk-table__caption">{{ vaccineAtSite }}</caption>
            <thead role="rowgroup" class="nhsuk-table__head">
              <tr role="row">
                <th role="columnheader" class="" scope="col">
                  Vaccine product
                </th>
                <th role="columnheader" class="" scope="col">
                  Active batches
                </th>
                <th role="columnheader" class="" scope="col" colspan="2">

                </th>
              </tr>
            </thead>
            <tbody class="nhsuk-table__body">
              {% for vaccineProduct in vaccineProductsAtSite %}
                <tr class="nhsuk-table__row">
                  <td class="nhsuk-table__cell">
                    {{ vaccineProduct }}
                  </td>
                  <td class="nhsuk-table__cell ">
                    {% set count = 0 %}
                    {% set thisVaccine = {} %}
                    {% for vaccine in data.vaccines %}
                      {% if (vaccine.siteCode == site) and (vaccine.vaccine == vaccineAtSite) and (vaccine.vaccineProduct == vaccineProduct) %}
                        {% set thisVaccine = vaccine %}
                      {% endif %}
                    {% endfor %}
                    {{ thisVaccine.batches | length }}
                  </td>
                  <td class="nhsuk-table__cell ">
                    <a href="/vaccines/{{ thisVaccine.id }}" class="nhsuk-link">View product</a>
                  </td>
                  <td class="nhsuk-table__cell ">
                    <div><a href="/vaccines/{{ thisVaccine.id }}/add" class="nhsuk-link">Add batch</a></div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endfor %}
      {% endfor %}


    </div>
  </div>

{% endblock %}

