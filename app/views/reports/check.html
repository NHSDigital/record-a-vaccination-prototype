{% extends 'layout.html' %}

{% set pageName = "Check and confirm" %}

{% set currentSection = "reports" %}

{% set organisation = {name: data.nhsTrusts[data.organisationCode]} %}

{% block beforeContent %}
  {{ backLink({
    href: "/reports/choose-data",
    text: "Back"
  }) }}
{% endblock %}

{% block content %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">

      <h1 class="nhsuk-heading-l">{{ pageName }}</h1>

      {% set dataFields = [] %}

      {% for field in data.patientDataToReport %}
        {% set dataFields = (dataFields.push(field), dataFields) %}
      {% endfor %}
      {% for field in data.staffDataToReport %}
        {% set dataFields = (dataFields.push(field), dataFields) %}
      {% endfor %}
      {% for field in data.siteDataToReport %}
        {% set dataFields = (dataFields.push(field), dataFields) %}
      {% endfor %}
      {% for field in data.consentAndEligibilityDataToReport %}
        {% set dataFields = (dataFields.push(field), dataFields) %}
      {% endfor %}
      {% for field in data.vaccinationDataToReport %}
        {% set dataFields = (dataFields.push(field), dataFields) %}
      {% endfor %}

      {% set dataValue %}
        {{ dataFields | join(", ") }}
      {% endset %}

      {% set sitesHtml %}
        <ul class="nhsuk-list">
          {% for site in sites | sort(false, false, "name") %}
            <li>{{ site.name }} ({{ site.id }})</li>
          {% endfor %}
        </ul>
      {% endset %}

      {{ summaryList({
        rows: [
          {
            key: {
              text: ("Date" if from == to else "From")
            },
            value: {
              text: (from | govukDate) if from
            },
            actions: {
              items: [
                {
                  href: "/reports/choose-dates",
                  text: "Change",
                  visuallyHiddenText: "name"
                }
              ]
            }
          },
          {
            key: {
              classes: "nhsuk-u-visually-hidden" if from == to,
              text: "To"
            },
            value: {
              classes: "nhsuk-u-visually-hidden"  if from == to,
              text: (to | govukDate) if to
            },
            actions: {
              classes: "nhsuk-u-visually-hidden" if from == to,
              items: [
                {
                  href: "/reports/choose-dates-2",
                  text: "Change",
                  visuallyHiddenText: "name"
                }
              ]
            }
          },
          {
            key: {
              text: ("Vaccines" if (data.vaccines | length) > 1 else "Vaccine")
            },
            value: {
              text: (data.vaccinesToReport | sort(false, false, "name") | join(", ") | capitaliseFirstLetter) if data.vaccines
            },
            actions: {
              items: [
                {
                  href: "/reports/choose-vaccines",
                  text: "Change",
                  visuallyHiddenText: "change vaccines"
                }
              ]
            }
          },
          {
            key: {
              text: ("Sites" if (data.siteIdsToReport | length) > 1 else "Site")
            },
            value: {
              html: sitesHtml
            },
            actions: {
              items: [
              {
                href: "/reports/choose-site",
                text: "Change",
                visuallyHiddenText: "change sites"
              }
              ]
            }
          },
          {
            key: {
              text: "Data"
            },
            value: {
              text: dataValue
            },
            actions: {
              items: [
                {
                  href: "/reports/choose-data",
                  text: "Change",
                  visuallyHiddenText: "change data"
                }
              ]
            }
          }
        ]
      }) }}

      <form action="/reports/download" method="post">
        {{ button({
          "text": "Confirm and create report"
        }) }}
      </form>


    </div>
  </div>
{% endblock %}


