{% extends 'layout.html' %}

{% set pageName = currentOrganisation.name %}
{% set currentSection = "organisations" %}

{% block content %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">

      <h1 class="nhsuk-heading-l">{{ pageName }}</h1>

      <p class="nhsuk-body-l">Invite an organisation to create an NHS Record a vaccination service (RAVS) account.</p>

      <p class="nhsuk-body-l">Once theyâ€™re set up, they can add other users and vaccination sites.</p>

      {{ button({
        "text": "Invite an organisation",
        "href": "/regions/add-organisation"
      }) }}

    </div>
  </div>

  {% if (organisations | length) > 0 %}
    <div class="nhsuk-grid-row">
      <div class="nhsuk-grid-column-full">

          <table class="nhsuk-table">
            <caption class="nhsuk-table__caption nhsuk-table__caption--m">Current organisations</caption>
            <thead role="rowgroup" class="nhsuk-table__head">
              <tr role="row">
                <th role="columnheader" class="" scope="col">
                  Name
                </th>
                <th role="columnheader" class="" scope="col">
                  Vaccines
                </th>
                <th role="columnheader" class="" scope="col">
                  Status
                </th>
                <th role="columnheader" class="" scope="col"></th>

              </tr>
            </thead>
            <tbody class="nhsuk-table__body">
              {% for organisation in (organisations | sort(false, false, "name")) %}
                <tr role="row" class="nhsuk-table__row">
                  <td class="nhsuk-table__cell">
                    <a href="/regions/organisations/{{ organisation.id }}">{{ organisation.name }} ({{ organisation.id }})</a>
                  </td>
                  <td class="nhsuk-table__cell ">
                    {% set vaccinesEnabled = [] %}
                    {% for vaccine in organisation.vaccines %}
                      {% if vaccine.status == "enabled" %}
                        {% set vaccinesEnabled = (vaccinesEnabled.push(vaccine.name), vaccinesEnabled) %}
                      {% endif %}
                    {% endfor %}

                    {{ vaccinesEnabled | sort | join(", ") }}
                  </td>
                  <td class="nhsuk-table__cell ">
                    {{ organisation.status }}
                  </td>
                  <td class="nhsuk-table__cell ">
                    {% if organisation.status == "Invited" %}
                      <a href="/regions/organisations/{{ organisation.id }}/delete">Delete <span class="nhsuk-u-visually-hidden">{{ organisation.name }}</span></a>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
      </div>
    </div>


    {{ pagination({
      next: {
        href: "#"
      },
      items: [
        {
          number: 1,
          href: "#",
          current: true
        },
        {
          number: 2,
          href: "#"
        }
      ]
    }) }}

  {% endif %}

  {% if closedOrganisationsCount > 0 %}
    <p><a href="/regions/organisations/closed">View {{ closedOrganisationsCount | plural("closed organisation") }}</a></p>
  {% endif %}

{% endblock %}
